{% extends "base.html" %}
{% load static %}

{% block title %}Transcript {{ tran_name }}{% endblock %}

{% block header %}
  <link rel="stylesheet" href="{% static 'css/wider-container.css' %}">

  <style>
      .sticky-offset {
          top: 56px
      }

      .list-group > .list-group > .list-group-item {
          padding-left: 2.5rem;
      }

      .tab-content > .tab-pane:not(.active) {
          display: block;
          height: 0;
          overflow-y: hidden;
      }

      #protein-network {
          position: relative;
          height: 840px;
          border: 2px solid lightgray;
      }

      #domain-network {
          position: relative;
          height: 840px;
          border: 2px solid lightgray;
      }

      #interaction-network {
          position: relative;
          height: 600px;
          border: 2px solid lightgray;
      }

      img {
          max-width: 100%;
          max-height: 100%;
          display: block; /* remove extra space below image */
      }

      .tab {
          margin-left: 90px;
      }

      .tab {
          margin-left: 50px;
      }

      img {
          max-width: 100%;
          max-height: 100%;
      }

      img.resize {
          max-width: 80%;
          max-height: 80%;
      }

      img.resize2 {
          max-width: 55%;
          max-height: 55%;
      }
  </style>

  <script>
      $(document).ready(function () {
          $('#Interaction_table').DataTable();
      });
  </script>
  <script src="{% static "domain/createNetwork.js" %}" type="text/javascript"></script>
{% endblock %}

{% block raw_content %}
<div class="wider-container my-3">
  <div class="row">
    <!-- Vertical pill selection menu-->
    <div class="col-lg-2 mb-2 rounded rounded d-flex flex-column">
      <div class="sticky-top sticky-offset align-items-center">
        <div style="background: white" class="shadow rounded p-2">
        <div class="nav flex-column nav-pills sticky-top sticky-offset" id="v-pills-tab" role="tablist"
             aria-orientation="vertical">
          <a class="nav-link h4 my-1 active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-overview"
             role="tab" aria-controls="v-pills-overview" aria-selected="true">Overview</a>
          <hr class="border-bottom" style="width: 100%;">
          <a class="nav-link" id="v-pills-protein-tab" data-toggle="pill" href="#v-pills-protein" role="tab"
             aria-controls="v-pills-protein" aria-selected="false">ProteinView</a>

          <a class="nav-link" id="v-pills-interaction-tab" data-toggle="pill" href="#v-pills-interaction"
             role="tab"
             aria-controls="v-pills-compare" aria-selected="false">InteractionView</a>

          {% if dis2 %}
            <a class="nav-link" id="v-pills-domain-tab" data-toggle="pill" href="#v-pills-domain" role="tab"
               aria-controls="v-pills-domain" aria-selected="false">DomainView</a>

            <a class="nav-link" id="v-pills-compare-tab" data-toggle="pill" href="#v-pills-compare"
               role="tab"
               aria-controls="v-pills-interaction" aria-selected="false">Other isoforms</a>
          {% endif %}

        </div>
      </div>
        <div class="my-4" style="width: 50%; margin: 0 auto">
          <a id="backToMenu" class="btn btn-primary shadow p-2" href="../../isoform_level">Back to search</a>
        </div>
      </div>
    </div>
    <!-- /Vertical pill selection menu -->

    <!-- Page content -->
    <div class="col-lg-10">

      <!-- Jumbotron overview-->
      <div class="jumbotron p-xl-4">
        <h1 class="display-4">Transcript {{ tran_name }}</h1>
        <hr>
        <h5 class="lead"><span
            style="font-weight:bold; display: inline-block; width: 180px">Gene name:</span>{{ gene_description|safe }}
        </h5>

        <h5 class="lead">
          <span
              style="font-weight:bold; display: inline-block; width: 180px">Transcript name:</span>{{ tran_name|safe }}
        </h5>

        <h5 class="lead">
          <span style="font-weight:bold; display: inline-block; width: 180px">NCBI gene ID:</span><a
            href="https://www.ncbi.nlm.nih.gov/gene/{{ entrezID|safe }}"
            target="_blank">{{ entrezID|safe }} </a>
        </h5>

        <h5 class="lead"><span style="font-weight:bold; display: inline-block; width: 180px">Ensembl:</span><a
            href="https://www.ensembl.org/id/{{ gID|safe }}"
            target="_blank">{{ gID|safe }}</a>, <a
            href="https://www.ensembl.org/id/{{ trID|safe }}"
            target="_blank">{{ trID|safe }}</a>
        </h5>

      </div>

      <!-- Tab content -->
      <div class="tab-content" id="v-pills-tabContent">
        <!-- Overview content -->
        <div class="tab-pane fade show active card shadow rounded" id="v-pills-overview" role="tabpanel"
             aria-labelledby="v-pills-overview-tab">
          <div class="card-body">
            <p class="lead text-center"><span
                style="font-weight:bold">Domain and exon architecture</span>: {{ text1 }}</p>


            <img class="mx-auto" src="{% get_media_prefix %}images/{{ trID }}.png">
            <center>
              <img class="resize2 text-center mt-2 img-fluid" src="{% static 'image/legend 3.png' %}">
            </center>
            <!-- Exon Table-->

            <div class="mt-5">
              <h5 class="mb-3">Select an exon from the table to assess the consequence of its skipping
                or choose different tabs to explore the isoform {{ tran_name }} interactions.</h5>
              <div class="table-responsive">
                <h6 class="mb-3" style="text-align: center">
                  {% autoescape off %}
                  {{ dt }}
                  {% endautoescape %}
                </h6>
              </div>
            </div>
          </div>
        </div>


        <!-- ProteinView content -->
        <div class="tab-pane fade card shadow rounded" id="v-pills-protein" role="tabpanel"
             aria-labelledby="v-pills-protein-tab">

          <h2 class="card-header"> ProteinView </h2>
          <div class="card-body">

            {% if not enable_Proteinview %}
              <h5 class="tab1"> ProteinView is not available for this protein because of its high
                number of partners in the PPI. Please check InteractionView or DomainView.</h5>
            {% endif %}

            {% if enable_Proteinview %}

              <h5 class="tab1"> ProteinView provides a general visualization of the protein and its
                domains interactions. Please select your view mode:</h5>
              <br>

              <h6 class="tab"><span style="font-weight:bold">PPI View</span>: show only protein
                interactions. Nodes are proteins and the central node is the selected transcript.
              </h6>
              <h6 class="tab"><span style="font-weight:bold">PPI-DDI View</span>: proteins are shown
                together with their domains and domains-domains interactions. </h6>
              <br>

              <h6 class="tab1"> You can move the protein and domain nodes as you wish for a better
                view.
                Notice that the generated network in this view can be very big or difficult to
                visualize. In that case, DomainView or InteractionView can provide better
                visualization. </h6>
              <br>
              <hr>
              <!-- View options -->
              <h5>
                <div class="form-group row">
                  <label for="nodeFilterSelect" class="col-sm-2 col-form-label">View Mode</label>
                  <div class="col-sm-10">
                    <select id="nodeFilterSelect" class="form-control">
                      <option value="PPI"> PPI View</option>
                      <option value="PPI-DDI"> PPI-DDI View</option>
                    </select>
                  </div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-2"><b>Options</b></div>
                  <div class="col-sm-2">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input" id="physicsSwitchProtein"
                             name="physics-checkbox-protein" checked>
                      <label class="custom-control-label" for="physicsSwitchProtein">Enable
                        physics</label>
                    </div>
                  </div>
                    <div class="col-sm-3">
                  <div class="form-inline">
                    <label for="formControlRange">Canvas height</label>
                    <input type="range" class="form-control-range" min="100" max="1000" step="10" value="840" id="proteinCanvasRange">
                  </div>
                </div>
                  </div>

                  <div class="form-group row">
                  <!-- Hide predicted DDI options in ProteinView since they have no impact anyway -->
                  <div class="col-sm-2 protein-view-predicted" style="visibility: hidden"><b>Predicted DDIs</b></div>
                  <div class="col-sm-2 protein-view-predicted" style="visibility: hidden">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input predicted-checkbox-protein"
                             id="high_protein"
                             name="predicted-checkbox-high"
                             value="high">
                      <label class="custom-control-label" for="high_protein">High</label>
                    </div>
                  </div>
                  <div class="col-sm-2 protein-view-predicted" style="visibility: hidden">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input predicted-checkbox-protein"
                             id="mid_protein"
                             name="predicted-checkbox-mid"
                             value="mid">
                      <label class="custom-control-label" for="mid_protein">Medium</label>
                    </div>
                  </div>
                  <div class="col-sm-2 protein-view-predicted" style="visibility: hidden">
                    <div class="custom-control custom-switch predicted">
                      <input type="checkbox" class="custom-control-input predicted-checkbox-protein"
                             id="low_protein"
                             name="predicted-checkbox-low"
                             value="low">
                      <label class="custom-control-label" for="low_protein">Low (confidence)</label>
                    </div>
                  </div>
                </div>
              </h5>

              <center>
                <div id="protein-network"></div>
                <script type="text/javascript">

                    var PR_LENGTH = 500,
                        LENGTH_domain = 20,
                        PR_DM = 400,
                        LENGTH_SUB = 50,
                        WIDTH_SCALE = 2,
                        GREEN = "green",
                        LIGHTGREEN = "lightgreen",
                        RED = "#C5000B",
                        //ORANGE = "orange",
                        YELLOW = "orange",
                        WHITE = "EED5EB"
                    //GRAY = '#666666',
                    GRAY = "gray",
                        BLACK = "#2B1B17";
                    missing = '#C70039';
                    Residue = '#DA70D6';

                    var proteinViewNodes = {
                        {% for key, value in pv_nodes.items %}
                            "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                        {% endfor %}
                    };

                    var proteinViewEdges = {
                        {% for key, value in pv_edges.items %}
                            "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                        {% endfor %}
                    };

                    const proteinViewSelector = document.getElementById("nodeFilterSelect");
                    // create a network
                    var proteinViewContainer = document.getElementById('protein-network');

                    var proteinViewOptions = {


                        interaction: {
                            navigationButtons: true,

                        },
                        physics: {
                            enabled: true,
                            barnesHut: {gravitationalConstant: -10000},
                            stabilization: {iterations: 20},
                        },


                        nodes: {
                            scaling: {
                                min: 16,
                                max: 32
                            }
                        },
                        edges: {
                            color: WHITE,
                            smooth: false,

                        },


                        groups: {
                            protein: {
                                shape: "dot",
                                color: GRAY, // orange
                                font:
                                    {
                                        size: 18, // px
                                    }
                            },


                            domain: {
                                shape: "triangle",
                                color: "#2B7CE9" // blue
                            },


                            transcript: {
                                shape: "square",
                                color: "#109618" // green
                            }
                        }
                    };

                    var proteinViewPhysicsCheckbox = document.querySelector("input[name=physics-checkbox-protein]");
                    var proteinViewPredictedCheckboxes = document.querySelectorAll(".predicted-checkbox-protein");

                    let proteinViewFilterValue = {value: proteinViewSelector.value};

                    var predictedItems = document.querySelectorAll(".protein-view-predicted");

                    // hide predicted items if proteinViewFilterValue is PPI
                    proteinViewSelector.addEventListener("change", function () {
                        if (proteinViewSelector.value === "PPI") {
                            predictedItems.forEach(function (item) {
                                item.style.visibility = "hidden";
                            });
                        } else {
                            predictedItems.forEach(function (item) {
                                item.style.visibility = "visible";
                            });
                        }
                    });

                    function proteinViewFilter(node) {
                        if (proteinViewSelector.value === "") {
                            return node.group === "protein";
                        }
                        switch (proteinViewSelector.value) {

                            case "PPI-DDI":
                                return node.source === "DDI";

                            case "PPI":
                                return node.group === "protein";

                            default:
                                return true;
                        }
                    }

                    startNetwork(proteinViewContainer, proteinViewOptions, proteinViewPredictedCheckboxes,
                        proteinViewPhysicsCheckbox, proteinViewSelector, proteinViewFilterValue,
                        proteinViewNodes, proteinViewEdges, proteinViewFilter);


                </script>
                <img class="resize" src="{% static 'image/network_legend.webp' %}" alt="">
              </center>

              {% if dis1 %}
                <h6 class="tab1"> Dashed edges represent missing domains in the selected protein
                  ({{ tran_name|safe }}) but present in other isoforms. These domain-domain
                  interactions are missing, which may also affect the interactions with their
                  respective proteins. </h6>
              {% endif %}
            {% endif %}
          </div>
        </div>


        <!-- DomainView content -->
        <div class="tab-pane fade card shadow rounded" id="v-pills-domain" role="tabpanel"
             aria-labelledby="v-pills-domain-tab">

          <h2 class="card-header"> DomainView </h2>
          <div class="card-body">
            <h5 class="tab1"> DomainView provides a more specific graphical visualization for each
              domain. The domain is shown only once, and all proteins containing the domain are linked
              to this domain node. </h5>
            <br>
            <hr>

            <!-- View options -->
            <h5>
              <div class="form-group row">
                <label for="nodeFilterSelect2" class="col-sm-2 col-form-label"><b>Pfam domain
                  ID</b></label>
                <div class="col-sm-10">
                  <select id="nodeFilterSelect2" class="form-control">
                    <optgroup label="Domains of the isoform">
                      {% for s in switch1 %}
                        {{ s|safe }}
                      {% endfor %}
                    </optgroup>
                    {% if dis1 %}
                      <optgroup label="Domains missing in the isoform">
                        {% for s in switch1_missing %}
                          {{ s|safe }}
                        {% endfor %}
                      </optgroup>
                    {% endif %}
                  </select>
                </div>
              </div>

              <div class="form-group row">
                <div class="col-sm-2"><b>Options</b></div>
                <div class="col-sm-3">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="physicsSwitchDomain"
                           name="physics-checkbox-domain" checked>
                    <label class="custom-control-label" for="physicsSwitchDomain">Enable
                      physics</label>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-inline">
                    <label for="formControlRange">Canvas height</label>
                    <input type="range" class="form-control-range" min="100" max="1000" step="10" value="840" id="domainCanvasRange">
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-sm-2"><b>Predicted DDIs</b></div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch disabled" aria-disabled="true">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-domain"
                           id="high_domain"
                           name="predicted-checkbox-high"
                           value="high">
                    <label class="custom-control-label" for="high_domain">High</label>
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-domain"
                           id="mid_domain"
                           name="predicted-checkbox-mid"
                           value="mid">
                    <label class="custom-control-label" for="mid_domain">Medium</label>
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch predicted">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-domain"
                           id="low_domain"
                           name="predicted-checkbox-low"
                           value="low">
                    <label class="custom-control-label" for="low_domain">Low (confidence)</label>
                  </div>
                </div>
              </div>
            </h5>

            <!-- Vis.js Network-->
            <div id="domain-network"></div>
            <script type="text/javascript">
                var L1 = 300,
                    L2 = 30,
                    PR_DM = 400,
                    LENGTH_SUB = 50,
                    WIDTH_SCALE = 2,
                    LIGHTGREEN = "lightgreen",
                    GREEN = "green",
                    RED = "#C5000B",
                    //ORANGE = "orange",
                    YELLOW = "orange",
                    WHITE = "EED5EB",
                    BLUE = "#2B7CE9",
                    //GRAY = '#666666',
                    GRAY = "gray",
                    BLACK = "#2B1B17";

                // create singular dictionary
                const domainViewNodes = {
                    {% for key, value in Domainview_nodes.items %}
                        "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                    {% endfor %}
                };

                // create singular dictionary
                const domainViewEdges = {
                    {% for key, value in Domainview_edges.items %}
                        "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                    {% endfor %}
                };

                // initiate all the variables needed for the network
                const domainViewFilterSelector = document.getElementById("nodeFilterSelect2");

                var domainViewContainer = document.getElementById('domain-network');

                var domainViewOptions = {


                    interaction: {
                        navigationButtons: true,

                    },

                    physics: {
                        barnesHut: {gravitationalConstant: -10000},
                        stabilization: {iterations: 15},

                    },

                    nodes: {
                        scaling: {
                            min: 16,
                            max: 32
                        }
                    },
                    edges: {
                        color: WHITE,
                        smooth: false,

                    },


                    groups: {
                        protein: {
                            shape: "dot",
                            color: GRAY, // orange
                            font:
                                {
                                    size: 18, // px
                                }
                        },


                        Domain: {
                            shape: "triangle",
                            color: "#2B7CE9" // blue
                        },


                        MDomain: {
                            shape: "triangle",
                            //color: "#2B7CE9", // also blue
                            borderWidth: "4",

                        }
                    }
                };

                var domainViewPhysicsCheckbox = document.querySelector("input[name=physics-checkbox-domain]");

                var domainViewCheckboxes = document.querySelectorAll(".predicted-checkbox-domain");

                let domainViewNodeFilter = {value: ""};

                function domainViewFilter(node) {
                    if (domainViewFilterSelector.value === "") {
                        return node.source === "{{ first_domain|safe}}";
                    }
                    switch (domainViewFilterSelector.value) {

                        {% for s in switch2 %}
                            {{ s|safe }}
                        {% endfor %}

                        default:
                            return true;
                    }
                }

                // start network from createNetwork.js file
                startNetwork(domainViewContainer, domainViewOptions, domainViewCheckboxes,
                    domainViewPhysicsCheckbox, domainViewFilterSelector, domainViewNodeFilter,
                    domainViewNodes, domainViewEdges, domainViewFilter);

            </script>
            <center>
              <img class="resize" src="{% static 'image/network_legend.webp' %}" alt="">
            </center>

            <!-- Tables-->
            <div style="text-align: center;" class="mt-5">
              <h4 class="lead">Domains of the isoform {{ tran_name }}</h4>

              <div class="table-responsive">
                <h6 class="mt-3">
                  {% autoescape off %}
                  {{ dt2 }}
                  {% endautoescape %}
                </h6>
              </div>
            </div>


            {% if dis1 %}
            <div style="text-align: center;" class="mt-5">
              <h4 class="lead"> Domains missing in the transcript but present in other
                isoforms.</h4>
            </div>

            <div class="table-responsive">
              <h6 class="mt-3">
                {% autoescape off %}
                {{ dt3 }}
                {% endautoescape %}
              </h6>
            </div>
            {% endif %}
          </div>
        </div>


        <!-- InteractionView content -->
        <div class="tab-pane fade card shadow rounded" id="v-pills-interaction" role="tabpanel"
             aria-labelledby="v-pills-interaction-tab">

          <h2 class="card-header"> InteractionView </h2>
          <div class="card-body">

            {% if dis2 %}
            <h5> InteractionView provides an interactive visualization of isoform-specific
              interactions. It shows transcripts with their interacting domains.
              The interactions in the table are confirmed by both Protein-Protein
              Interactions (PPI) and Domain-Domain Interactions (DDI) networks. If residue-level
              evidence is available a <span>&#9733;</span> is shown in the table. </h5>
            <br/>
            <h5> You can select the protein partner to visualize it individually and download the
              isoform interactions table.</h5>
            <br/>

            <h6 class="tab1" style="text-align: left;"><span>&#9733;</span> An interaction with
              residue-level evidence. </h6>

            <br>
            <hr>
            <!-- View options -->
            <h5>
              <!-- Interaction partner menu -->
              <div class="form-group row">
                <label for="inputEmail3" class="col-sm-2 d-flex align-items-center" style="vertical-align: middle"><b>Interaction partner</b></label>
                <!-- modal button -->
                <div class="col-sm-5">
                  <button type="button" class="btn btn-light border col" data-toggle="modal" data-target="#exampleModal"
                          style="background: white; color: #495057; font-size: 1rem;">
                    Select interaction partner
                  </button>
                </div>
                <div class="col-sm-4 d-flex align-items-center">
                  <!-- Currently selected info -->
                  Currently selected: &nbsp; <b id="selectedInteractionView"> {{ first_name | safe }}</b>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <div class="col-md-4">
                          <h5 class="modal-title" id="exampleModalLabel">Interactions + % missing DDIs</h5>
                        </div>
                        <div class="col-md-4">
                          <button class="btn btn-primary" id="interactionViewDeselect">Deselect all</button>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                      </div>
                      <div class="modal-body">
                        <div class="row" id="nodeFilterSelect3">
                          {% for key, value in Interactiveview_select.items %}
                            <div class="col">
                              <p><b>{{ key }}</b></p>
                              {% for s in value %}
                                <div class="form-check my-1">
                                  <input class="form-check-input" type="checkbox" name="InteractionChecks"
                                         id="{{ s.1 }}"
                                         value="{{ s.1 }}">
                                  <label class="form-check-label" style="width: 50%" for="{{ s.1 }}">{{ s.0 }}</label>
                                  <label class="form-check-label" style="text-align: right" id="{{ s.1 }}Label"
                                         for="{{ s.1 }}Radio">{{ s.2 }}%</label>
                                </div>
                              {% endfor %}
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


              <!-- Option menu -->
              <div class="form-group row">
                <div class="col-sm-2"><b>Options</b></div>
                <div class="col-sm-3">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="physicsSwitchInteraction"
                           name="physics-checkbox-interaction" checked>
                    <label class="custom-control-label" for="physicsSwitchInteraction">Enable
                      physics</label>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-inline">
                    <label for="formControlRange">Canvas height</label>
                    <input type="range" class="form-control-range" min="100" max="1000" step="10" value="840" id="interactionCanvasRange">
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-sm-2"><b>Predicted DDIs</b></div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-interaction"
                           id="high_interaction"
                           name="predicted-checkbox-high"
                           value="high">
                    <label class="custom-control-label" for="high_interaction">High</label>
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-interaction"
                           id="mid_interaction"
                           name="predicted-checkbox-mid"
                           value="mid">
                    <label class="custom-control-label" for="mid_interaction">Medium</label>
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="custom-control custom-switch predicted">
                    <input type="checkbox" class="custom-control-input predicted-checkbox-interaction"
                           id="low_interaction"
                           name="predicted-checkbox-low"
                           value="low">
                    <label class="custom-control-label" for="low_interaction">Low (confidence)</label>
                  </div>
                </div>
              </div>
            </h5>

            <div style="text-align: center;">
              <div id="interaction-network"></div>

              <script type="text/javascript">

                  var PR_LENGTH = 500,
                      LENGTH_domain = 20,
                      PR_DM = 400,
                      LENGTH_SUB = 50,
                      WIDTH_SCALE = 2,
                      LIGHTGREEN = "lightgreen"
                  GREEN = "green",
                      RED = "#C5000B",
                      //ORANGE = "orange",
                      YELLOW = "orange",
                      WHITE = "EED5EB"
                  //GRAY = '#666666',
                  GRAY = "gray",
                      BLACK = "#2B1B17";
                  missing = '#C70039';
                  Residue = '#DA70D6';


                  var interactionViewNodes = {
                      {% for key, value in pv_nodes.items %}
                          "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                      {% endfor %}
                  };

                  // create an array with edges
                  var interactionViewEdges = {
                      {% for key, value in pv_edges.items %}
                          "{{ key }}": [ {% for edge in value %} {{ edge|safe }} {% endfor %} ],
                      {% endfor %}
                  };

                  const interactionViewSelector = document.getElementById("nodeFilterSelect3");

                  // create a network
                  var interactionViewContainer = document.getElementById('interaction-network');

                  var interactionViewOptions = {


                      interaction: {
                          navigationButtons: true,

                      },
                      physics: {
                          enabled: true,
                          barnesHut: {gravitationalConstant: -10000},
                          stabilization: {iterations: 20},
                      },


                      nodes: {
                          scaling: {
                              min: 16,
                              max: 32
                          }
                      },
                      edges: {
                          color: WHITE,
                          smooth: false,

                      },


                      groups: {
                          protein: {
                              shape: "dot",
                              color: GRAY, // orange
                              font:
                                  {
                                      size: 18, // px
                                  }
                          },


                          domain: {
                              shape: "triangle",
                              color: "#2B7CE9" // blue
                          },


                          transcript: {
                              shape: "square",
                              color: "#109618" // green
                          }
                      }
                  };

                  const interactionViewEntrezID = "{{ entrezID|safe }}";

                  let interactionViewFilterSet = new Set([interactionViewEntrezID]);

                  var interactionViewPhysicsCheckbox = document.querySelector("input[name=physics-checkbox-interaction]");

                  var interactionViewCheckboxes = document.querySelectorAll(".predicted-checkbox-interaction");

                  function interactionViewFilter(node) {
                      if (interactionViewFilterSet.size === 1) {
                          return (node.id === "{{ entrezID|safe }}") || (node.id === "{{ first_vict|safe }}")
                              || (node.origin === "{{ first_vict|safe }}") || (node.origin === "{{ entrezID|safe }}");
                      }
                      return interactionViewFilterSet.has(node.id) || interactionViewFilterSet.has(node.origin);
                  }

                  const selectedInteractionView = document.getElementById("selectedInteractionView");
                  // change the FilterSet and the Names when a partner is selected
                  interactionViewSelector.addEventListener("change", function () {
                      console.log(interactionViewSelector)
                      const interactionViewPartners = document.querySelectorAll("input[name=InteractionChecks]:checked");
                      // get the labels of all partners
                      const names = Array.from(interactionViewPartners).map(function (partner) {
                          return partner.labels[0].innerText;
                      });
                      // add all partners as a comma seperated string list
                      // selectedInteractionView.innerHTML = names.map(function (name) {return name;}).join(", ");
                      selectedInteractionView.innerHTML = names.join(", ");
                      // set the values of the interactionViewFilterSet and add the entrezID of the original transcript
                      interactionViewFilterSet = new Set(Array.from(interactionViewPartners).map(function (partner) {
                          return partner.value;
                      }));
                      interactionViewFilterSet.add(interactionViewEntrezID);
                  });

                  // Deselect all button
                  const interactionViewDeselect = document.getElementById("interactionViewDeselect");
                  interactionViewDeselect.addEventListener("click", function () {
                      interactionViewFilterSet = new Set([interactionViewEntrezID]);
                      selectedInteractionView.innerHTML = "{{ first_name | safe }}";
                      interactionViewSelector.querySelectorAll("input[name=InteractionChecks]:checked").forEach(function (input) {
                          input.checked = false;
                      });
                  });

                  startNetwork(interactionViewContainer, interactionViewOptions, interactionViewCheckboxes,
                      interactionViewPhysicsCheckbox, interactionViewSelector, interactionViewFilterSet,
                      interactionViewNodes, interactionViewEdges, interactionViewFilter);



              </script>
              <center>
                <img class="resize" src="{% static 'image/network_legend.webp' %}" alt="">
              </center>
            </div>

            <div class="mt-5">
              <h4 class="lead" style="text-align: center;"> Protein partners of the
                isoform {{ tran_name|safe }}  </h4>
              <h6 class="my-4">
                {% autoescape off %}
                {{ dt4 }}
                {% endautoescape %}
              </h6>


            </div>

            <h6 class="tab1" style="text-align: left;"><span
                style="font-weight:bold">Retained DDIs</span>:
              For every partner, a list of the retained DDI in this protein variant is shown.
            </h6>
            <h6 class="tab1" style="text-align: left;"><span
                style="font-weight:bold">Missing DDIs</span>: The interactions missing from the
              selected protein but present in other isoforms. You can check other variants of this
              gene 'Other isoforms' section. </h6>

            <div style="text-align: center;" class="mt-5">
              <a href="{% get_media_prefix %}/table 2/{{ trID|safe }}.csv"
                 class="btn btn-secondary px-4 py-2 btn-sm">Download table as CSV</a>
            </div>

            {% else %}
            <h5 class="tab1" style="text-align: left;"> The protein doesn't have any interaction
              confirmed
              by both PPI and DDI networks.</h5>
            {% endif %}
          </div>
        </div>


        <!-- Compare with other isoforms content -->
        <div class="tab-pane fade card shadow rounded" id="v-pills-compare" role="tabpanel"
             aria-labelledby="v-pills-compare-tab">

          {% if dis2 %}

          <h2 class="card-header">Compare with other isoforms</h2>
          <div class="card-body">
            <h5 class="tab1" style="text-align: left;"></h5>
            <div style="text-align: center;">
              <h4 class="lead"> List of isoforms </h4>
              <div class="table-responsive">
                <h6 class="mt-3">
                  {% autoescape off %}
                  {{ dt5 }}
                  {% endautoescape %}
                </h6>
              </div>
            </div>
          </div>
          {% endif %}
        </div>

      </div>
      <!-- /Page content -->
    </div>
  </div>
</div>
<script>
    // write an exception that just ignores if inputElement is null
    function addHeightListener(inputId, outputId) {
        try {
            const inputElement = document.getElementById(inputId);
            inputElement.addEventListener("input", function() {
              document.getElementById(outputId).style.height = `${this.value}px`;
            });
        } catch (e) {
            console.log(e);
        }
    }

    addHeightListener("proteinCanvasRange", "protein-network");
    addHeightListener("domainCanvasRange", "domain-network");
    addHeightListener("interactionCanvasRange", "interaction-network");
</script>
{% endblock %}
